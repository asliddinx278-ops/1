<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8"/>
  <title>Restoran Menyu</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:20px;background:#f7f7f7}
    h2{margin-top:0}
    .item{display:flex;justify-content:space-between;align-items:center;background:#fff;margin:10px 0;padding:12px 16px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}
    button.add{background:#007bff;color:#fff;border:none;padding:6px 12px;border-radius:5px;cursor:pointer}
    #orderBtn{display:none;width:100%;margin-top:15px;background:#28a745;color:#fff;font-size:18px;padding:12px;border:none;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>
  <h2>üçΩ Menyu</h2>

  <div class="item">
    <span>Lag‚Äòmon</span>
    <span>25 000 so‚Äòm</span>
    <button class="add" onclick="add('Lag‚Äòmon',25000)">Qo‚Äòshish</button>
  </div>
  <div class="item">
    <span>Shashlik</span>
    <span>18 000 so‚Äòm</span>
    <button class="add" onclick="add('Shashlik',18000)">Qo‚Äòshish</button>
  </div>
  <div class="item">
    <span>Cola 0,5</span>
    <span>7 000 so‚Äòm</span>
    <button class="add" onclick="add('Cola 0,5',7000)">Qo‚Äòshish</button>
  </div>

  <!-- universal knopka -->
  <button id="orderBtn" onclick="sendOrder()">‚úÖ Buyurtma berish</button>

  <script>
    const tg = window.Telegram.WebApp;
    let cart = [];

    function add(name, price){
      cart.push({name, price});
      document.getElementById('orderBtn').style.display = 'block';
      document.getElementById('orderBtn').textContent = `‚úÖ Buyurtma berish (${cart.length})`;
    }

    function sendOrder(){
      if(!cart.length) return;

      const total = cart.reduce((s,i)=>s+i.price, 0);
      const payload = {
        name: tg && tg.initDataUnsafe && tg.initDataUnsafe.user
               ? tg.initDataUnsafe.user.first_name
               : prompt('Ismingiz:') || 'Anonim',
        phone: prompt('Telefon: +998') || '+998901234567',
        order: cart.map(i=>`${i.name}√ó1`).join(', '),
        total
      };

      /* ---------- Telegram WebApp ---------- */
      if(tg && tg.sendData){
        tg.sendData(JSON.stringify(payload));
        return;
      }

      /* ---------- Oddiy brauzer ---------- */
      fetch('https://1-two-azure.vercel.app/order', {
        method : 'POST',
        headers: {'Content-Type':'application/json'},
        body   : JSON.stringify(payload)
      })
      .then(r => r.text())
      .then(msg => alert(msg))
      .catch(err => alert('Xato: ' + err));
    }

    /* Telegram bo‚Äòlsa expand qilamiz */
    if(tg) tg.expand();
  </script>
</body>
</html>
