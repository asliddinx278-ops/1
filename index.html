const { Telegraf } = require('telegraf');
const bot = new Telegraf('7896924437:AAHlbtMj-Zs4grZlviqTD7JwLKhPAIZX1so');
const adminChatId = '7961099561';

bot.start((ctx) => {
  ctx.reply('ðŸ½ Menyu:', {
    reply_markup: {
      inline_keyboard: [[
        { text: 'Menyu', web_app: { url: 'https://1-two-azure.vercel.app' } }
      ]]
    }
  });
});

bot.on('web_app_data', async (ctx) => {
  const data = JSON.parse(ctx.webAppData.data.json());

  const message =
    `ðŸ†• Yangi buyurtma!\n\n` +
    `ðŸ‘¤ Ism: ${data.name}\n` +
    `ðŸ“ž Telefon: ${data.phone}\n` +
    `ðŸ› Buyurtma: ${data.order}\n` +
    `ðŸ’° Jami: ${data.total} soâ€˜m`;

  // adminga yuborish
  await ctx.telegram.sendMessage(adminChatId, message);

  // foydalanuvchiga natija qaytarib, WebApp-ni yopamiz
  await ctx.answerWebAppQuery(ctx.webAppData.query_id, {
    type: 'article',
    id: ctx.webAppData.query_id,
    title: 'âœ… Buyurtma qabul qilindi',
    input_message_content: { message_text: 'Buyurtmangiz adminga yuborildi, tez orada siz bilan bogâ€˜lanamiz!' }
  });
});

bot.launch(() => console.log('âœ… Bot ishga tushdi!'));
