<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8"/>
  <title>Restoran Menyu</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:20px;background:#f7f7f7}
    h2{margin-top:0}
    .item{display:flex;justify-content:space-between;align-items:center;background:#fff;margin:10px 0;padding:12px 16px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}
    button{background:#007bff;color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer}
  </style>
</head>
<body>
  <h2>üçΩ Menyu</h2>

  <div class="item">
    <span>Lag‚Äòmon</span>
    <span>25 000 so‚Äòm</span>
    <button onclick="add('Lag‚Äòmon',25000)">Qo‚Äòshish</button>
  </div>
  <div class="item">
    <span>Shashlik</span>
    <span>18 000 so‚Äòm</span>
    <button onclick="add('Shashlik',18000)">Qo‚Äòshish</button>
  </div>
  <div class="item">
    <span>Cola 0,5</span>
    <span>7 000 so‚Äòm</span>
    <button onclick="add('Cola 0,5',7000)">Qo‚Äòshish</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.setText("‚úÖ Buyurtma berish").show();

    let cart = [];

    function add(name, price){
      cart.push({name, price});
      tg.MainButton.setText(`‚úÖ Buyurtma berish (${cart.length})`);
    }

    /* ========== DEBUG ========== */
    Telegram.WebApp.onEvent('mainButtonClicked', () => {
      console.log('[DEBUG] mainButton clicked');
      if (!cart.length) {
        console.log('[DEBUG] cart empty, return');
        return;
      }

      const total = cart.reduce((s,i)=>s+i.price, 0);
      const payload = JSON.stringify({
        name: tg.initDataUnsafe.user.first_name,
        phone: '+998901234567',
        order: cart.map(i=>`${i.name}√ó1`).join(', '),
        total
      });

      console.log('[DEBUG] sendData payload:', payload);
      try {
        Telegram.WebApp.sendData(payload);
        console.log('[DEBUG] sendData SUCCESS');
      } catch (e) {
        console.error('[DEBUG] sendData ERROR:', e);
      }
    });
    /* =========================== */
  </script>
</body>
</html>
